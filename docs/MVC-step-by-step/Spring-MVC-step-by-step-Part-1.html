<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <meta http-equiv="CONTENT-TYPE"
 content="text/html; charset=ISO-8859-1">
  <title>Spring MVC step-by-step Part 1</title>
  <meta name="GENERATOR" content="OpenOffice.org 1.1.0  (Linux)">
  <meta name="CREATED" content="20030630;21474000">
  <meta name="CHANGED" content="20031121;22411000">
  <style>
	<!--
		@page { size: 8.5in 11in; margin-left: 1.25in; margin-right: 1.25in; margin-top: 1in; margin-bottom: 1in }
		TD P { margin-bottom: 0.08in }
		P { margin-bottom: 0.08in }
	-->
	</style>
  <meta content="Thomas Risberg" name="author">
  <meta
 content="Developing a Spring Framework MVC application step-by-step -- Part 1"
 name="description">
</head>
<body style="direction: ltr;" lang="en-US">
<p style="margin-bottom: 0in;" align="center"><font size="4"><b>Developing
a Spring Framework MVC application step-by-step</b></font></p>
<p style="margin-bottom: 0in;" align="center">Part 1 &ndash; Basic
Application and Environment Setup</p>
<p style="margin-bottom: 0in;" align="center"><b>Thomas Risberg</b>
<br>
July, 2003</p>
<p style="margin-bottom: 0in;" align="center">(Revised April, 2005)</p>
<p style="margin-bottom: 0in;" align="center"><br>
</p>
<p style="margin-bottom: 0in;">This is a step-by-step account of how
to develop a web application from scratch using the Spring Framework.</p>
<p style="margin-bottom: 0in;">Prerequisites:</p>
<ul>
  <ul>
    <li>
      <p style="margin-bottom: 0in;">Java SDK (<i>I am currently using
version 1.4.2</i>)</p>
    </li>
    <li>
      <p style="margin-bottom: 0in;">Ant (<i>using version 1.6.2</i>)</p>
    </li>
    <li>
      <p style="margin-bottom: 0in;">Apache Tomcat (<i>using version
5.0.28</i>)</p>
    </li>
  </ul>
</ul>
<p style="margin-bottom: 0in;">You should also be reasonably
comfortable using the above software.</p>
<p style="margin-bottom: 0in;">I am not going to cover a lot of
background information or theory in this document -- there are plenty
of books available that covers this in depth. Instead we will dive
right into developing the application.</p>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><b>Step 1 &ndash; development directory</b></p>
<p style="margin-bottom: 0in;">We are going to need a place to keep
all the source and other files we will be creating, so I create a
directory that I name 'springapp'. You can place this directory in
your home folder or in some other location. I created mine in a
'projects' directory that I already had in my home directory so the
full path to my directory is '/Users/trisberg/projects/springapp'.
Inside this directory I create a 'src' directory to hold all Java
source files. Then I create another directory that I name 'war'. This
directory will hold everything that should go into the WAR file, that
we would use to deploy our application. All source files other than
Java source, like JSPs and configuration files, belongs in this
directory.</p>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><b>Step 2 &ndash; index.jsp</b></p>
<p style="margin-bottom: 0in;">I will start by creating a JSP page
named 'index.jsp' in the war directory. This is the entry point for
our application.</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="90%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#ffcc99" valign="top" width="100%">
      <p><b><font size="2"><font face="Nimbus Mono L">springapp/war/index.jsp</font></font></b>
      </p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#ffffcc" valign="top" width="100%">
      <pre>&lt;html&gt;<br>&lt;head&gt;&lt;title&gt;Example :: Spring Application&lt;/title&gt;&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt;Example - Spring Application&lt;/h1&gt;<br>&lt;p&gt;This is my test.&lt;/p&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;</pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;">Just to have a complete web
application, I create a web.xml in a WEB-INF directory that I create
under the war directory.</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="1004">
  <col width="994"> <tbody>
    <tr>
      <td bgcolor="#ffcc99" valign="top" width="994">
      <p><b><font size="2"><font face="Nimbus Mono L">springapp/war/WEB-INF/web.xml</font></font></b>
      </p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#ffffcc" valign="top" width="994">
      <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>&lt;!DOCTYPE web-app PUBLIC '-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN' 'http://java.sun.com/dtd/web-app_2_3.dtd'&gt;<br><br>&lt;web-app&gt;<br><br>&lt;/web-app&gt;</pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><b>Step 3 &ndash; deploying the
application to Tomcat</b></p>
<p style="margin-bottom: 0in;">Next, I write an Ant build script that
we are going to use throughout this document. There are tasks for
building and deploying the application. A separate build script
contains the app server specific tasks There are also tasks for
controlling the application under Tomcat.</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="90%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#ffcc99" valign="top" width="100%">
      <p><b><font size="2"><font face="Nimbus Mono L">springapp/build.xml</font></font></b>
      </p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#ffffcc" valign="top" width="100%">
      <pre>&lt;?xml version="1.0"?&gt;<br><br>&lt;project name="springapp" basedir="." default="usage"&gt;<br>    &lt;property file="build.properties"/&gt;<br><br>    &lt;property name="src.dir" value="src"/&gt;<br>    &lt;property name="web.dir" value="war"/&gt;<br>    &lt;property name="build.dir" value="${web.dir}/WEB-INF/classes"/&gt;<br>    &lt;property name="name" value="springapp"/&gt;<br><br>    &lt;path id="master-classpath"&gt;<br>        &lt;fileset dir="${web.dir}/WEB-INF/lib"&gt;<br>            &lt;include name="*.jar"/&gt;<br>        &lt;/fileset&gt;<br>        &lt;!-- We need the servlet API classes:        --&gt;<br>        &lt;!--   for Tomcat 4.1 use servlet.jar        --&gt;<br>        &lt;!--   for Tomcat 5.0 use servlet-api.jar    --&gt;<br>        &lt;!--   for Other app server - check the docs --&gt;<br>        &lt;fileset dir="${appserver.home}/common/lib"&gt;<br>            &lt;include name="servlet*.jar"/&gt;<br>        &lt;/fileset&gt;<br>        &lt;pathelement path="${build.dir}"/&gt;<br>    &lt;/path&gt;<br><br>    &lt;target name="usage"&gt;<br>        &lt;echo message=""/&gt;<br>        &lt;echo message="${name} build file"/&gt;<br>        &lt;echo message="-----------------------------------"/&gt;<br>        &lt;echo message=""/&gt;<br>        &lt;echo message="Available targets are:"/&gt;<br>        &lt;echo message=""/&gt;<br>        &lt;echo message="build     --&gt; Build the application"/&gt;<br>        &lt;echo message="deploy    --&gt; Deploy application as directory"/&gt;<br>        &lt;echo message="deploywar --&gt; Deploy application as a WAR file"/&gt;<br>        &lt;echo message="install   --&gt; Install application in Tomcat"/&gt;<br>        &lt;echo message="reload    --&gt; Reload application in Tomcat"/&gt;<br>        &lt;echo message="start     --&gt; Start Tomcat application"/&gt;<br>        &lt;echo message="stop      --&gt; Stop Tomcat application"/&gt;<br>        &lt;echo message="list      --&gt; List Tomcat applications"/&gt;<br>        &lt;echo message=""/&gt;<br>    &lt;/target&gt;<br><br>    &lt;target name="build" description="Compile main source tree java files"&gt;<br>        &lt;mkdir dir="${build.dir}"/&gt;<br>        &lt;javac destdir="${build.dir}" target="1.3" debug="true"<br>               deprecation="false" optimize="false" failonerror="true"&gt;<br>            &lt;src path="${src.dir}"/&gt;<br>            &lt;classpath refid="master-classpath"/&gt;<br>        &lt;/javac&gt;<br>    &lt;/target&gt;<br><br>    &lt;target name="deploy" depends="build" description="Deploy application"&gt;<br>        &lt;copy todir="${deploy.path}/${name}" preservelastmodified="true"&gt;<br>            &lt;fileset dir="${web.dir}"&gt;<br>                &lt;include name="**/*.*"/&gt;<br>            &lt;/fileset&gt;<br>        &lt;/copy&gt;<br>    &lt;/target&gt;<br><br>    &lt;target name="deploywar" depends="build" description="Deploy application as a WAR file"&gt;<br>        &lt;war destfile="${name}.war"<br>             webxml="${web.dir}/WEB-INF/web.xml"&gt;<br>            &lt;fileset dir="${web.dir}"&gt;<br>                &lt;include name="**/*.*"/&gt;<br>            &lt;/fileset&gt;<br>        &lt;/war&gt;<br>        &lt;copy todir="${deploy.path}" preservelastmodified="true"&gt;<br>            &lt;fileset dir="."&gt;<br>                &lt;include name="*.war"/&gt;<br>            &lt;/fileset&gt;<br>        &lt;/copy&gt;<br>    &lt;/target&gt;<br><br>&lt;!-- ============================================================== --&gt;<br>&lt;!-- Tomcat tasks - remove these if you don't have Tomcat installed --&gt;<br>&lt;!-- ============================================================== --&gt;<br><br>    &lt;taskdef name="install" classname="org.apache.catalina.ant.InstallTask"&gt;<br>        &lt;classpath&gt;<br>            &lt;path location="${appserver.home}/server/lib/catalina-ant.jar"/&gt;<br>        &lt;/classpath&gt;<br>    &lt;/taskdef&gt;<br>    &lt;taskdef name="reload" classname="org.apache.catalina.ant.ReloadTask"&gt;<br>        &lt;classpath&gt;<br>            &lt;path location="${appserver.home}/server/lib/catalina-ant.jar"/&gt;<br>        &lt;/classpath&gt;<br>    &lt;/taskdef&gt;<br>    &lt;taskdef name="list" classname="org.apache.catalina.ant.ListTask"&gt;<br>        &lt;classpath&gt;<br>            &lt;path location="${appserver.home}/server/lib/catalina-ant.jar"/&gt;<br>        &lt;/classpath&gt;<br>    &lt;/taskdef&gt;<br>    &lt;taskdef name="start" classname="org.apache.catalina.ant.StartTask"&gt;<br>        &lt;classpath&gt;<br>            &lt;path location="${appserver.home}/server/lib/catalina-ant.jar"/&gt;<br>        &lt;/classpath&gt;<br>    &lt;/taskdef&gt;<br>    &lt;taskdef name="stop" classname="org.apache.catalina.ant.StopTask"&gt;<br>        &lt;classpath&gt;<br>            &lt;path location="${appserver.home}/server/lib/catalina-ant.jar"/&gt;<br>        &lt;/classpath&gt;<br>    &lt;/taskdef&gt;<br><br>    &lt;target name="install" description="Install application in Tomcat"&gt;<br>        &lt;install url="${tomcat.manager.url}"<br>                 username="${tomcat.manager.username}"<br>                 password="${tomcat.manager.password}"<br>                 path="/${name}"<br>                 war="${name}"/&gt;<br>    &lt;/target&gt;<br><br>    &lt;target name="reload" description="Reload application in Tomcat"&gt;<br>        &lt;reload url="${tomcat.manager.url}"<br>                 username="${tomcat.manager.username}"<br>                 password="${tomcat.manager.password}"<br>                 path="/${name}"/&gt;<br>    &lt;/target&gt;<br><br>    &lt;target name="start" description="Start Tomcat application"&gt;<br>        &lt;start url="${tomcat.manager.url}"<br>                 username="${tomcat.manager.username}"<br>                 password="${tomcat.manager.password}"<br>                 path="/${name}"/&gt;<br>    &lt;/target&gt;<br><br>    &lt;target name="stop" description="Stop Tomcat application"&gt;<br>        &lt;stop url="${tomcat.manager.url}"<br>                 username="${tomcat.manager.username}"<br>                 password="${tomcat.manager.password}"<br>                 path="/${name}"/&gt;<br>    &lt;/target&gt;<br><br>    &lt;target name="list" description="List Tomcat applications"&gt;<br>        &lt;list url="${tomcat.manager.url}"<br>                 username="${tomcat.manager.username}"<br>                 password="${tomcat.manager.password}"/&gt;<br>    &lt;/target&gt;<br><br>&lt;!-- End Tomcat tasks --&gt;<br><br>&lt;/project&gt;</pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;">This script now
contains all the targets that we are going to need to make our
development efforts easier. I am not going to cover this script in
detail since most if not all of it is pretty much standard Ant and
Tomcat stuff. You can just copy the above build file and put it at
the root of your development directory tree. We also need a
build.properties file that you should customize to match your server
installation. This file belongs in the same directory as the
build.xml file.</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="90%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#ffcc99" valign="top" width="100%">
      <p><b><font size="2"><font face="Nimbus Mono L">springapp/build.properties</font></font></b>
      </p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#ffffcc" valign="top" width="100%">
      <pre># Ant properties for building the springapp<br><br>appserver.home=${user.home}/jakarta-tomcat-5.0.28<br>deploy.path=${appserver.home}/webapps<br><br>tomcat.manager.url=http://localhost:8080/manager<br>tomcat.manager.username=admin<br>tomcat.manager.password=tomcat</pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;"><i>If you are on a system where you are
not the owner of the Tomcat install, then the Tomcat owner must
either grant you full access to the webapps directory or the owner
must create a new directory named 'springapp' in the 'webapps'
directory of the Tomcat installation, and also give you full rights
to deploy to this newly created directory. On Linux I run the command
<b><font size="2"><font face="Fixed, monospace">chmod a+rwx springapp</font></font></b>
to give everybody full rights to this directory.</i></p>
<p style="margin-bottom: 0in;"><i>If you are using a different web
application server, then you can remove the Tomcat specific tasks at
the end of the build script. You will have to rely on your server's
hot deploy feature, or you will have to stop and start your
application manually.</i></p>
<p style="margin-bottom: 0in;">Now I run Ant to
make sure that everything is working OK. You should have your current
directory set to the 'springapp' directory.</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="85%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#e6e6ff" valign="top" width="100%">
      <pre><font color="#280099">[trisberg@localhost springapp]$ ant</font>
<font color="#280099">Buildfile: build.xml</font>
<font color="#280099"> </font>
<font color="#280099">usage:</font>
<font color="#280099"> </font>
<font color="#280099">     [echo] springapp build file</font>
<font color="#280099">     [echo] -----------------------------------</font>
<font color="#280099"> </font>
<font color="#280099">     [echo] Available targets are:</font>
<font color="#280099"> </font>
<font color="#280099">     [echo] build     --&gt; Build the application</font>
<font color="#280099">     [echo] deploy    --&gt; Deploy application as directory</font>
<font color="#280099">     [echo] deploywar --&gt; Deploy application as a WAR file</font>
<font color="#280099">     [echo] install   --&gt; Install application in Tomcat</font>
<font color="#280099">     [echo] reload    --&gt; Reload application in Tomcat</font>
<font color="#280099">     [echo] start     --&gt; Start Tomcat application</font>
<font color="#280099">     [echo] stop      --&gt; Stop Tomcat application</font>
<font color="#280099">     [echo] list      --&gt; List Tomcat applications</font>
<font color="#280099"> </font>
<font color="#280099"> </font>
<font color="#280099">BUILD SUCCESSFUL</font>
<font color="#280099">Total time: 2 seconds</font></pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;">Last action here
is to do the actual deployment. Just run Ant and specify 'deploy' or
'deploywar' as the target.</p>
<p style="margin-bottom: 0in;"><br>
</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="85%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#e6e6ff" valign="top" width="100%">
      <pre><font color="#280099">[trisberg@localhost springapp]$ ant deploy</font>
<font color="#280099">Buildfile: build.xml</font>
<font color="#280099"> </font>
<font color="#280099">build:<br>    [mkdir] Created dir: /Users/trisberg/projects/springapp/war/WEB-INF/classes<br><br>deploy:<br>     [copy] Copying 2 files to /Users/trisberg/jakarta-tomcat-5.0.28/webapps/springapp<br><br></font><font
 color="#280099">BUILD SUCCESSFUL</font>
<font color="#280099">Total time: 2 seconds</font></pre>
      </td>
    </tr>
  </tbody>
</table>
<p><br>
<br>
</p>
<p style="margin-bottom: 0in;"><b>Step 4 &ndash; Test the application</b></p>
<p style="margin-bottom: 0in;">Let's just quickly start Tomcat and
make sure that we can access the application. Use the 'list' task
from our build file to see if Tomcat has picked up the new
application.</p>
<p style="margin-bottom: 0in;"><br>
</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="85%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#e6e6ff" valign="top" width="100%">
      <pre><font color="#280099">[trisberg@localhost springapp]$ ant list</font>
<font color="#280099">Buildfile: build.xml</font>
<font color="#280099"> </font>
<font color="#280099">list:<br>     [list] OK - Listed applications for virtual host localhost<br><br>     [list] /admin:running:0:/Users/trisberg/jakarta-tomcat-5.0.28/server/webapps/admin<br><br>     [list] /webdav:running:0:/Users/trisberg/jakarta-tomcat-5.0.28/webapps/webdav<br><br>     [list] /servlets-examples:running:0:/Users/trisberg/jakarta-tomcat-5.0.28/webapps/servlets-examples<br><br> <span
 style="font-weight: bold;">    [list] /springapp:running:0:/Users/trisberg/jakarta-tomcat-5.0.28/webapps/springapp</span><br
 style="font-weight: bold;"><br>     [list] /jsp-examples:running:0:/Users/trisberg/jakarta-tomcat-5.0.28/webapps/jsp-examples<br><br>     [list] /balancer:running:0:balancer<br><br>     [list] /tomcat-docs:running:0:/Users/trisberg/jakarta-tomcat-5.0.28/webapps/tomcat-docs<br><br>     [list] /:running:0:/Users/trisberg/jakarta-tomcat-5.0.28/webapps/ROOT<br><br>     [list] /manager:running:0:/Users/trisberg/jakarta-tomcat-5.0.28/server/webapps/manager<br></font><font
 color="#280099"> </font>
<font color="#280099"> </font>
<font color="#280099">BUILD SUCCESSFUL</font>
<font color="#280099">Total time: 1 second</font></pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;">If it is not listed, use the 'install'
task to get the application installed in Tomcat.</p>
<p style="margin-bottom: 0in;"><br>
</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="85%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#e6e6ff" valign="top" width="100%">
      <pre><font color="#280099">[trisberg@localhost springapp]$ ant install</font>
<font color="#280099">Buildfile: build.xml</font>
<font color="#280099"> </font>
<font color="#280099">install:</font>
<font color="#280099">  [install] OK - Installed application at context path /springapp</font>
<font color="#280099"> </font>
<font color="#280099"> </font>
<font color="#280099">BUILD SUCCESSFUL</font>
<font color="#280099">Total time: 2 seconds</font></pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;">Now open a browser and browse to
<a href="http://localhost:8080/springapp/index.jsp">http://localhost:8080/springapp/index.jsp</a>.
</p>
<p style="margin-bottom: 0in;"><img
 src="Spring-MVC-step-by-step_html_m5b7553b2.png" name="Graphic1"
 align="left" border="0" height="528" width="840"><br clear="left">
<br>
</p>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><b>Step 5 &ndash; Download Spring
distribution</b></p>
<p style="margin-bottom: 0in;">If you have not already downloaded the
Spring Framework Release file, now is the time to do so. I am
currently using 'spring-framework-1.2-with-dependencies.zip' that can
be downloaded
from <a href="http://www.springframework.org/download.html">www.springframework.org/download.html</a>.
I unzipped this file in my home directory. We are going to use
several files from this download later on.</p>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><font size="4"><u><b>This completes the
setup of the environment that is necessary, and now we can start
actually developing our Spring Framework MVC application.</b></u></font></p>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><b>Step 6 &ndash; Modify web.xml in
WEB-INF directory</b></p>
<p style="margin-bottom: 0in;">Go to the 'springapp/war/ WEB-INF'
directory. Modify the minimal 'web.xml' file that we created earlier.
Now we will modify it to suit our needs. We define a
DispatcherServlet that is going to control where all our request are
routed based on information we will enter at a later point. It also
has a standard servlet-mapping entry that maps to the url patterns
that we will be using. I have decided to let any url with an '.htm'
extension be routed to the 'springapp' dispatcher.</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="90%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#ffcc99" valign="top" width="100%">
      <p><b><font size="2"><font face="Nimbus Mono L">springapp/war/WEB-INF/web.xml</font></font></b>
      </p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#ffffcc" valign="top" width="100%">
      <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>&lt;!DOCTYPE web-app PUBLIC '-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN' 'http://java.sun.com/dtd/web-app_2_3.dtd'&gt;<br><br>&lt;web-app&gt;<br><br><font
 color="#800000">  &lt;servlet&gt;</font>
<font color="#800000">    &lt;servlet-name&gt;springapp&lt;/servlet-name&gt;</font>
<font color="#800000">    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</font>
<font color="#800000">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</font>
<font color="#800000">  &lt;/servlet&gt;</font>

<font color="#800000">  &lt;servlet-mapping&gt;</font>
<font color="#800000">    &lt;servlet-name&gt;springapp&lt;/servlet-name&gt;</font>
<font color="#800000">    &lt;url-pattern&gt;*.htm&lt;/url-pattern&gt;</font>
<font color="#800000">  &lt;/servlet-mapping&gt;</font>

<font color="#800000">  &lt;welcome-file-list&gt;</font>
<font color="#800000">    &lt;welcome-file&gt;</font>
<font color="#800000">      index.jsp</font>
<font color="#800000">    &lt;/welcome-file&gt;</font>
<font color="#800000">  &lt;/welcome-file-list&gt;</font>

&lt;/web-app&gt;</pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;">Next, create a file called
'springapp-servlet.xml' in the springapp/war/WEB-INF directory (you
can copy an example of this file from the Spring distributions
sample/skeletons/webapp-minimal directory). This is the file where
definitions used by the DispatcherServlet should be entered. It is
named based on the servlet-name from web.xml with '-servlet'
appended. This is a standard naming convention used in the Spring
Framework. Now, add a bean entry named springappController and make
the class SpringappController. This defines the controller that our
application will be using. We also need to add a url mapping so the
DispatcherServlet knows which controller should be invoked for
different url:s.</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="90%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#ffcc99" valign="top" width="100%">
      <p><b><font size="2"><font face="Nimbus Mono L">springapp/war/WEB-INF/springapp-servlet.xml</font></font></b>
      </p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#ffffcc" valign="top" width="100%">
      <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" "http://www.springframework.org/dtd/spring-beans-2.0.dtd"&gt;<br><br>&lt;!--<br>  - Application context definition for "springapp" DispatcherServlet.<br>  --&gt;<br><br>&lt;beans&gt;<br>    &lt;bean id="springappController" class="SpringappController"/&gt;<br><br>    &lt;bean id="urlMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"&gt;<br>        &lt;property name="mappings"&gt;<br>            &lt;props&gt;<br>                &lt;prop key="/hello.htm"&gt;springappController&lt;/prop&gt;<br>            &lt;/props&gt;<br>        &lt;/property&gt;<br>    &lt;/bean&gt;<br>&lt;/beans&gt;</pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><b>Step 7 &ndash; Copy jars to
WEB-INF/lib</b></p>
<p style="margin-bottom: 0in;">First create a 'lib' directory in the
'war/WEB-INF' directory.&nbsp; Then, from the Spring distribution, copy
spring.jar (spring-framework-1.2/dist/spring.jar) to the new
war/WEB-INF/lib directory.
Also copy commons-logging jars
to the war/WEB-INF/lib directory
(spring-framework-1.2/lib/jakarta-commons/commons-logging.jar).
We are also going to need a log4j jar.
Copy log4j-1.2.9.jar to the war/WEB-INF/lib directory
(spring-framework-1.2/lib/log4j/log4j-1.2.9.jar).
These jars will be deployed to the server and they are also used
during the build process.</p>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><b>Step 8 &ndash; Create your
Controller</b></p>
<p style="margin-bottom: 0in;">Create your Controller &ndash; I named
mine SpringappController.java and placed it in the springapp/src
directory.</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="90%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#ffcc99" valign="top" width="100%">
      <p><b><font size="2"><font face="Nimbus Mono L">springapp/src/SpringappController.java</font></font></b>
      </p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#ffffcc" valign="top" width="100%">
      <pre>import org.springframework.web.servlet.mvc.Controller;<br>import org.springframework.web.servlet.ModelAndView;<br><br>import javax.servlet.ServletException;<br>import javax.servlet.http.HttpServletRequest;<br>import javax.servlet.http.HttpServletResponse;<br><br>import java.io.IOException;<br><br>public class SpringappController implements Controller {<br><br>    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response)<br>            throws ServletException, IOException {<br>        return new ModelAndView("");<br>    }<br>}</pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;">This is as basic a
Controller as you can use. We will be expanding this later on, and we
will also later on extend some provided abstract base
implementations. The Controller &ldquo;handles&rdquo; the request and
returns a ModelAndView. We have not yet defined any Views, so right
now there is nothing to do.</p>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><b>Step 9 &ndash; Build the Application</b></p>
<p style="margin-bottom: 0in;">Run the 'build' task of the build.xml.
Hopefully the code compiles OK.</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="85%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#e6e6ff" valign="top" width="100%">
      <pre><font color="#280099">[trisberg@localhost springapp]$ ant build</font>
<font color="#280099">Buildfile: build.xml</font>
<font color="#280099"> </font>
<font color="#280099">build:</font>
<font color="#280099">    [javac] Compiling 1 source file to /Users/trisberg/projects/springapp/war/WEB-INF/classes</font>
<font color="#280099"> </font>
<font color="#280099">BUILD SUCCESSFUL</font>
<font color="#280099">Total time: 2 seconds</font></pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><b>Step 10 &ndash; Copy and modify
log4j.properties</b></p>
<p style="margin-bottom: 0in;">The Spring
Framework uses log4j for logging so we have to create a configuration
file for log4j. Copy the log4j.properties from the sample Petclinic
application
(spring-framework-1.2/samples/petclinic/war/WEB-INF/log4j.properties)
to the war/WEB-INF/classes directory (this directory should have been
created in the previous step). Now uncomment or modify the
log4j.rootLogger property and change the name and location of
the logfile that will be written. I decided to have it written to the
same directory as all other Tomcat logs.</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="90%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#ffcc99" valign="top" width="100%">
      <p><font face="Nimbus Mono L"><font size="2"><b>springapp/war/WEB-INF/classes/log4j.properties</b></font></font></p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#ffffcc" valign="top" width="100%">
      <pre># For JBoss: Avoid to setup Log4J outside $JBOSS_HOME/server/default/deploy/log4j.xml!<br># For all other servers: Comment out the Log4J listener in web.xml to activate Log4J.<br>log4j.rootLogger=INFO, stdout, logfile<br><br>log4j.appender.stdout=org.apache.log4j.ConsoleAppender<br>log4j.appender.stdout.layout=org.apache.log4j.PatternLayout<br>log4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - &lt;%m&gt;%n<br><br>log4j.appender.logfile=org.apache.log4j.RollingFileAppender<br><span
 style="font-weight: bold;">log4j.appender.logfile.File=/Users/trisberg/jakarta-tomcat-5.0.28/logs/springapp.log</span><br
 style="font-weight: bold;">log4j.appender.logfile.MaxFileSize=512KB<br># Keep three backup files.<br>log4j.appender.logfile.MaxBackupIndex=3<br># Pattern to output: date priority [category] - message<br>log4j.appender.logfile.layout=org.apache.log4j.PatternLayout<br>log4j.appender.logfile.layout.ConversionPattern=%d %p [%c] - %m%n</pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><b>Step 11 &ndash; Deploy Application</b></p>
<p style="margin-bottom: 0in;">Run the 'deploy' task and then the
'stop' and 'start' tasks of the build.xml. This will force a reload
of the application. We have to check the Tomcat logs for any
deployment errors &ndash; there could be typos in the above xml files
or there could be missing classes or jar files. This is an example of
what it should look like.
(/Users/trisberg/jakarta-tomcat-5.0.28/logs/springapp.log)</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="85%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#e6e6ff" valign="top" width="100%">
      <pre><font color="#280099">2005-04-24 14:58:18,112 INFO [org.springframework.web.servlet.DispatcherServlet] - Initializing servlet 'springapp'<br>2005-04-24 14:58:18,261 INFO [org.springframework.web.servlet.DispatcherServlet] - FrameworkServlet 'springapp': initialization started<br>2005-04-24 14:58:18,373 INFO [org.springframework.beans.factory.xml.XmlBeanDefinitionReader] - Loading XML bean definitions from ServletContext resource [/WEB-INF/springapp-servlet.xml]<br>2005-04-24 14:58:18,498 INFO [org.springframework.web.context.support.XmlWebApplicationContext] - Bean factory for application context [WebApplicationContext for namespace 'springapp-servlet']: org.springframework.beans.factory.support.DefaultListableBeanFactory defining beans [springappController,urlMapping]; root of BeanFactory hierarchy<br>2005-04-24 14:58:18,505 INFO [org.springframework.web.context.support.XmlWebApplicationContext] - 2 beans defined in application context [WebApplicationContext for namespace 'springapp-servlet']<br>2005-04-24 14:58:18,523 INFO [org.springframework.core.CollectionFactory] - JDK 1.4+ collections available<br>2005-04-24 14:58:18,524 INFO [org.springframework.core.CollectionFactory] - Commons Collections 3.x available<br>2005-04-24 14:58:18,537 INFO [org.springframework.web.context.support.XmlWebApplicationContext] - Unable to locate MessageSource with name 'messageSource': using default [org.springframework.context.support.DelegatingMessageSource@8dacb]<br>2005-04-24 14:58:18,539 INFO [org.springframework.web.context.support.XmlWebApplicationContext] - Unable to locate ApplicationEventMulticaster with name 'applicationEventMulticaster': using default [org.springframework.context.event.SimpleApplicationEventMulticaster@5674a4]<br>2005-04-24 14:58:18,549 INFO [org.springframework.ui.context.support.UiApplicationContextUtils] - No ThemeSource found for [WebApplicationContext for namespace 'springapp-servlet']: using ResourceBundleThemeSource<br>2005-04-24 14:58:18,556 INFO [org.springframework.beans.factory.support.DefaultListableBeanFactory] - Pre-instantiating singletons in factory [org.springframework.beans.factory.support.DefaultListableBeanFactory defining beans [springappController,urlMapping]; root of BeanFactory hierarchy]<br>2005-04-24 14:58:18,557 INFO [org.springframework.beans.factory.support.DefaultListableBeanFactory] - Creating shared instance of singleton bean 'springappController'<br>2005-04-24 14:58:18,603 INFO [org.springframework.beans.factory.support.DefaultListableBeanFactory] - Creating shared instance of singleton bean 'urlMapping'<br>2005-04-24 14:58:18,667 INFO [org.springframework.web.servlet.DispatcherServlet] - Using context class [org.springframework.web.context.support.XmlWebApplicationContext] for servlet 'springapp'<br>2005-04-24 14:58:18,668 INFO [org.springframework.web.servlet.DispatcherServlet] - Unable to locate MultipartResolver with name 'multipartResolver': no multipart request handling provided<br>2005-04-24 14:58:18,670 INFO [org.springframework.web.servlet.DispatcherServlet] - Unable to locate LocaleResolver with name 'localeResolver': using default [org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver@318309]<br>2005-04-24 14:58:18,675 INFO [org.springframework.web.servlet.DispatcherServlet] - Unable to locate ThemeResolver with name 'themeResolver': using default [org.springframework.web.servlet.theme.FixedThemeResolver@c11e94]<br>2005-04-24 14:58:18,681 INFO [org.springframework.web.servlet.DispatcherServlet] - No HandlerAdapters found in servlet 'springapp': using default<br>2005-04-24 14:58:18,700 INFO [org.springframework.web.servlet.DispatcherServlet] - No ViewResolvers found in servlet 'springapp': using default<br>2005-04-24 14:58:18,700 INFO [org.springframework.web.servlet.DispatcherServlet] - FrameworkServlet 'springapp': initialization completed in 439 ms<br>2005-04-24 14:58:18,704 INFO [org.springframework.web.servlet.DispatcherServlet] - Servlet 'springapp' configured successfully</font></pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;"><b>Step 12 &ndash; Create a View</b></p>
<p style="margin-bottom: 0in;">Now it is time to create our first
view. I will use a JSP page that I decided to name hello.jsp. I'll
put it in the war directory to begin with.</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="90%">
  <col width="256*"> <tbody>
    <tr>
      <td bgcolor="#ffcc99" valign="top" width="100%">
      <p><font face="Nimbus Mono L"><font size="2"><b>springapp/war/hello.jsp</b></font></font></p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#ffffcc" valign="top" width="100%">
      <pre>&lt;html&gt;<br>&lt;head&gt;&lt;title&gt;Example :: Spring Application&lt;/title&gt;&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt;Hello - Spring Application&lt;/h1&gt;<br>&lt;p&gt;Greetings.&lt;/p&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;</pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;">Nothing fancy here, but it will do for
now. Next we have to modify the SpringappController to forward to
this view.</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="876">
  <col width="866"> <tbody>
    <tr>
      <td bgcolor="#ffcc99" valign="top" width="866">
      <p><b><font size="2"><font face="Nimbus Mono L">springapp/src/SpringappController.java</font></font></b>
      </p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#ffffcc" valign="top" width="866">
      <pre>import org.springframework.web.servlet.mvc.Controller;<br>import org.springframework.web.servlet.ModelAndView;<br><br>import javax.servlet.ServletException;<br>import javax.servlet.http.HttpServletRequest;<br>import javax.servlet.http.HttpServletResponse;<br><br>import java.io.IOException;<br><br><font
 color="#800000">import org.apache.commons.logging.Log;</font>
<font color="#800000">import org.apache.commons.logging.LogFactory;</font>

public class SpringappController implements Controller {

<font color="#800000">    /** Logger for this class and subclasses */</font>
<font color="#800000">    protected final Log logger = LogFactory.getLog(getClass());</font>

    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {

        <font
 color="#800000">logger.info("SpringappController - returning hello view");</font>

        return new ModelAndView("<font
 color="#800000">hello.jsp</font>");<br>    }<br>}</pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;">While I was
modifying this class, I also added a logger so we can verify that we
actually got here. Changes are highlighted in <font color="#800000">red</font>.
The model that this class returns is actually resolved via a
ViewResolver. Since we have not specified a specific one, we are
going to get a default one that just forwards to a url matching the
name of the view specified. We will modify this later on.</p>
<p style="margin-bottom: 0in;">Now compile and
deploy the application. After instructing Tomcat to stop and then
start the application, everything should get reloaded.</p>
<p style="margin-bottom: 0in;">Let's try it in a browser &ndash; enter
the url <a href="http://localhost:8080/springapp/hello.htm">http://localhost:8080/springapp/hello.htm</a>
and we should see the following:</p>
<p style="margin-bottom: 0in;"><img
 src="Spring-MVC-step-by-step_html_m3871950e.png" name="Graphic2"
 align="left" border="0" height="572" width="742"><br clear="left">
<br>
</p>
<p style="margin-bottom: 0in;">We can also check
the log &ndash; I'm only showing the last entries, but we can see
that the controller did get invoked and that it forwarded to the
hello view. (/Users/trisberg/jakarta-tomcat-5.0.28/logs/springapp.log)</p>
<table border="1" bordercolor="#000000" cellpadding="4" cellspacing="0"
 width="1226">
  <col width="1216"> <tbody>
    <tr>
      <td bgcolor="#e6e6ff" valign="top" width="1216">
      <pre><font color="#280099">2005-04-24 15:01:56,217 INFO [org.springframework.web.servlet.DispatcherServlet] - FrameworkServlet 'springapp': initialization completed in 372 ms<br>2005-04-24 15:01:56,217 INFO [org.springframework.web.servlet.DispatcherServlet] - Servlet 'springapp' configured successfully<br>2005-04-24 15:03:57,908 INFO [SpringappController] - SpringappController - returning hello view</font><font
 color="#280099"></font></pre>
      </td>
    </tr>
  </tbody>
</table>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><b>Summary</b></p>
<p style="margin-bottom: 0in;">Let's take quick look at the parts of
our application that we have created so far.</p>
<ol>
  <li>
    <p style="margin-bottom: 0in;">An introduction page <b>index.jsp</b>
that does not do anything useful. It was just used to test our setup.
We will later change this to actually provide a link into our
application.</p>
  </li>
  <li>
    <p style="margin-bottom: 0in;">A DispatcherServlet with a
corresponding <b>springapp-servlet.xml</b> configuration file.</p>
  </li>
  <li>
    <p style="margin-bottom: 0in;">A controller <b>springappController.java</b>
with limited functionality &ndash; it just forwards a ModelAndView to
the ViewResolver. Actually, we only have an empty model so far, but we
will fix this later.</p>
  </li>
  <li>
    <p style="margin-bottom: 0in;">A view <b>hello.jsp</b> that again
is extremely basic. But the whole setup works and we are now ready to
add more functionality.</p>
  </li>
</ol>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;"><a href="Spring-MVC-step-by-step.html"
 target="_self">Back</a>
<a href="Spring-MVC-step-by-step-Part-2.html" target="_self">Part 2
&ndash;
Developing and Configuring the Application</a></p>
<p style="margin-bottom: 0in;"><br>
</p>
<p style="margin-bottom: 0in;">Copyright &copy; 2003-2005, Thomas
Risberg</p>
</body>
</html>
