<!--$Id: build.xml,v 1.1 2003-11-22 09:05:41 johnsonr Exp $-->
<project name="spring-metadata" default="targets" basedir=".">  
  
  <!-- ================================================================== -->
  <!--                            Properties                              -->
  <!-- ================================================================== -->
  
  <!-- location of various directories -->
  <property name="examples" value="."/>  
  <property name="build" value="./build"/>
  <property name="spring.classpath" value="../../../../.classes"/>
  <property name="spring.testclasspath" value="../../../../.testclasses"/>
  <property name="spring.lib" value="../../../../lib"/>
  
  <property name="build.compiler" value="org.springframework.metadata.ant.MetadataCompilerAdapter"/>	
  <property name="attributepackages" value="org.springframework.transaction.interceptor"/>
  
  <path id="master-classpath">

		<fileset dir="../../../../lib">
			<include name="**/*.jar"/>
		</fileset>

	</path>

  <!-- javac compile options -->
  <property name="deprecation" value="false"/>
  <property name="debug" value="on"/>
  
  <path id="metadata.classpath">
    <pathelement location="${build}"/>
    <pathelement location="${spring.classpath}"/>    
    <pathelement location="${spring.lib}/cglib/bcel-5.1.jar"/>    
    <pathelement location="${spring.lib}/qdox/qdox-1.2.jar"/>    
    <pathelement location="${spring.lib}/jakarta-commons/commons-logging.jar"/>
    <pathelement location="${spring.lib}/regexp/jakarta-oro-2.0.7.jar"/>        
  </path>
  

  <!-- include the custom task -->
  <taskdef name="metadataCompiler"
           
           classname="org.springframework.metadata.ant.MetadataCompilerTask">
           <classpath>
           	<pathelement location="${spring.classpath}"/>
           <pathelement location="${spring.testclasspath}"/>
           </classpath>
           	<classpath  refid="master-classpath"/>
          </taskdef>
 

  <!-- Display all the targets -->
  <target name="targets">
    <echo message=""/>
    <echo message="ANT build for SpringFramework metadata examples"/>
    <echo message=""/>
    <echo message="The following targets are available:"/>
    <echo message="  clean       Cleans the build and distribution directories"/>
    <echo message="  compile     Compiles the java code and performs attribute compilation."/>
    <echo message="  runexample  Compiles and runs the example"/>
  </target>
  

  <!-- Prepare target directories -->
  <target name="prepare" >
    <mkdir dir="${build}"/>
  </target>

  <!-- Remove all the directories created in the prepare target -->
  <target name="clean">
    <delete dir="${build}"/>
  </target>


  <!-- Build the test code -->
  <target name="compile" depends="prepare" >
    <javac 	srcdir="${examples}" 
	   		destdir="${build}" 
	   		debug="${debug}" 
	   		deprecation="${deprecation}">
	   		 <classpath >
	   		 	<pathelement path="${spring.testclasspath}"/>
	   		 	<pathelement path="${spring.classpath}"/>
	   		 </classpath>
	   		 <classpath  refid="master-classpath"/>
	   		 	
    </javac>    
  </target>

  <!-- compile the attributes -->
  <target name="metadatacompile" >
	<metadataCompiler sourcepath="${examples}"
 			 		  classpathref="metadata.classpath"
 			          destdir="${build}"
 			          attributepackages="org.springframework.transaction.interceptor">
    </metadataCompiler>
   
  </target>

  
  <!-- run the example -->
  <target name="runexample" depends="compile" >
    <junit printsummary="yes" fork="yes" haltonfailure="yes">
    	<classpath>
    	<pathelement location="./build"/>
		    <pathelement location="${spring.classpath}"/>
		    <pathelement path="${spring.testclasspath}"/>
		     <pathelement path="${spring.testclasspath}"/>
		     <!-- Get XML appc file -->
		<pathelement path="../../../../test"/>
  </classpath>
  <classpath  refid="master-classpath"/>
    	
  <formatter type="plain" usefile="false"/>
  <test name="org.springframework.enterpriseservices.MetadataEnterpriseServicesTest"/>
</junit>

  </target>  


  
</project>


